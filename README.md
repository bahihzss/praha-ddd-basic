# 課題１
## DDD に関する用語の解説

### 値オブジェクト

読んで字の如く、値を表すオブジェクトで、ドメインモデル層に実装します。

識別子を持たず、保持している値が等価であれば、同一のものとみなします。

これも関連するデータと業務ロジックを一緒におくことで、凝集度を高められます。

```typescript
class Name {
  constructor (
    private readonly firstName: string,
    private readonly lastName: string
  ) {}

  get fullname() {
    return `${this.firstName} ${this.lastName}`
  }

  equals(name: Name) {
    return this.firstName === name.firstName && this.lastName === name.lastName
  }
}
```

### エンティティ

エンティティの辞書的な意味は「（独立して）存在するもの」です。

DDD ではユーザーや注文などといった、それ自体が独立して存在するものに対して

1. 識別子
2. 関連するデータ
3. 関連する業務ロジック

を持たせたドメインモデル層のオブジェクトをエンティティと呼びます。

関連するデータと業務ロジックを一緒に置いておくことで、凝集度を高められます。

```typescript
class User {
  constructor (
    private readonly id: string,
    private readonly name: Name,
    private readonly birthday: Date
  ) {}

  get fullname() {
    return this.name.fullname
  }

  get age() {
    return Math.floor((Date.now() - this.birthday.getTime()) / 1000 / 60 / 60 / 24 / 365)
  }

  equals(user: User) {
    return this.id === user.id
  }
}
```

### 集約

集約は永続化する際に整合性を保つ必要がある単位で、ドメインモデル層のオブジェクトをグループにしたものです。

### ドメイン

ドメインとは、そのシステムで解決したい問題をもつ対象のことです。  

たとえば、インターネットを通じて商品を販売する EC サイトの場合

* 注文を受け付けたい -> 注文ドメイン
* 商品を管理したい -> 商品ドメイン
* お客さんの情報を管理したい -> 顧客ドメイン
* お金を管理したい -> 決済ドメイン
* お客さんに商品を届けたい -> 配送ドメイン

といったドメインが存在します。

### ユビキタス言語

ユビキタス言語とは、ドメインエキスパートと開発者が同じ言葉を使うことで、開発者がドメインを理解しやすくするための言語です。  
例えば、ユーザーの名前を `name` という変数名で表現するのではなく、`userName` という変数名で表現することで、ドメインエキスパートと開発者が同じ言葉を使うことができます。

ユビキタス言語は、ドメインに対する理解に合わせて常に更新し、ソースコードやドキュメントでは必ずユビキタス言語を使うようにします。

### 境界づけられたコンテキスト

境界づけられたコンテキストとは、ドメインモデルを分割するための単位です。

ドメインで例に挙げた EC サイトのような大きなシステムは複数のドメインを扱う必要があります。   
それぞれのドメインにおいては同じ言葉が違う責務を持つことがあります。

例えば、商品は
* EC サイトで注文をしたお客さんから見れば「購入した物」
* 発送担当者から見れば「お客さんに送る荷物」
になります。

この場合にこのふたつを同じモデルで扱うと、単一責任の原則を満たせません。

これを解決するために、最初にも述べた様にドメインモデルを問題領域ごとに分割します。
この各ドメインはそれぞれのユビキタス言語を持つことになるので、文脈という意味のコンテキストという言葉を使います。

### ドメインサービス

ドメインサービスとは、ドメインモデルのオブジェクトの振る舞いを表現するためのオブジェクトです。  
エンティティや値オブジェクトといったドメインモデルのどれにも属さない業務ロジックはここに実装されます。

### リポジトリ

リポジトリパターンは、永続化のための処理をインターフェースに隠匿するためのデザインパターンです。  
ドメインの永続化に関する操作は、リポジトリインターフェースを介して行い使う側からは実装を意識しないでいいようにします。

### アプリケーション（ユースケース）

ドメインモデル、ドメインサービス、リポジトリを組み合わせて、実際の業務におけるユースケースを実現するためのオブジェクトです。

### CQS/CQRS

CQS とは、Command Query Separation の略で、メソッド単位でコマンドとクエリを分離することを意味します。
ひとつのメソッドの中でコマンドとクエリが混在していると、クエリの結果がデータに影響を与えてしまう可能性があります。

CQRS は Command-Query Responsibility Segregation の略で、コマンドとクエリを別々のモデルに分離することを意味します。
読み込みと書き込みでは扱うロジックが異なることが多いため、それぞれのモデルを分けることで、それぞれのモデルに最適化した処理を行うことができます。

### DTO

DTO とは、Data Transfer Object の略で、データの転送を行うためのオブジェクトです。
ドメインモデルをそのまま永続化すると、ドメインモデルの変更によって永続化の仕様が変わってしまう可能性があります。
そのため、ドメインモデルと永続化の仕様を分離するために DTO を使います。

### ドメインモデル貧血症

ドメインモデル貧血症とは、ドメインモデルに業務ロジックが実装されていないことを指します。
それによって同じ業務ロジックがドメインモデルの外に何度も出現することになり、凝集度が下がります。
